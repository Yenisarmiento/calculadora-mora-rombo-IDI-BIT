<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Calculadora de Intereses Moratorios - Rombo</title>

  <style>
    :root {
      --rombo-dark-blue: #002060;     /* Fondo corporativo */
      --rombo-mid-blue: #4080E0;      /* Azul intermedio */
      --rombo-light-cyan: #40C0E0;    /* Azul claro del logo */
      --rombo-white: #FFFFFF;
    }

    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: var(--rombo-white);
      color: var(--rombo-dark-blue);
    }

    .container {
      max-width: 820px;
      margin: 0 auto;
      background: var(--rombo-white);
      padding: 30px 35px;
      border-radius: 12px;
      box-shadow: 0 5px 25px rgba(0,0,0,0.25);
      border-top: 8px solid var(--rombo-dark-blue);
    }

    h1 {
      text-align: center;
      margin-bottom: 5px;
      color: var(--rombo-dark-blue);
      font-size: 32px;
      font-weight: bold;
    }

    .subtitulo {
      text-align: center;
      margin-bottom: 25px;
      color: #555;
      font-size: 13px;
    }

    h2 {
      margin-top: 25px;
      color: var(--rombo-dark-blue);
      border-left: 6px solid var(--rombo-dark-blue);
      padding-left: 10px;
      font-size: 20px;
      font-weight: bold;
    }

    .fila {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }

    .field {
      flex: 1;
      min-width: 200px;
      margin-bottom: 15px;
    }

    label {
      font-weight: bold;
      color: var(--rombo-dark-blue);
      margin-bottom: 4px;
      display: block;
    }

    input {
      width: 100%;
      padding: 8px 10px;
      border: 2px solid var(--rombo-dark-blue);
      border-radius: 5px;
      background: #f5f7ff;
      color: #000;
    }

    button {
      padding: 10px 20px;
      border: none;
      cursor: pointer;
      border-radius: 6px;
      font-weight: bold;
      font-size: 14px;
      transition: 0.2s;
      margin-right: 8px;
    }

    .btn-calcular {
      background: var(--rombo-dark-blue);
      color: var(--rombo-white);
    }
    .btn-calcular:hover {
      background: var(--rombo-mid-blue);
    }

    .btn-limpiar {
      background: #777;
      color: var(--rombo-white);
    }
    .btn-limpiar:hover {
      background: #555;
    }

    .btn-pdf {
      background: var(--rombo-light-cyan);
      color: var(--rombo-dark-blue);
    }
    .btn-pdf:hover {
      background: var(--rombo-mid-blue);
      color: var(--rombo-white);
    }

    .result {
      background: #e6f0ff;
      border: 2px solid var(--rombo-light-cyan);
      color: var(--rombo-dark-blue);
      padding: 10px 12px;
      border-radius: 6px;
      font-weight: bold;
      margin-top: 5px;
    }
  </style>
</head>

<body>

  <div class="container" id="contenido">
    <h1>Calculadora de Mora - Rombo</h1>
    <p class="subtitulo">Valores liquidados al día de hoy.</p>

    <h2>Datos del deudor</h2>

    <div class="fila">
      <div class="field">
        <label>Nombre completo</label>
        <input type="text" id="nombreDeudor" placeholder="Ej: Juan Pérez">
      </div>

      <div class="field">
        <label>Documento de identificación</label>
        <input type="text" id="documentoId" placeholder="Ej: CC 1234567890">
      </div>

      <div class="field">
        <label>Número de la cuota</label>
        <input type="text" id="numeroCuota" placeholder="Ej: 3 de 12">
      </div>
    </div>

    <h2>Datos de la obligación</h2>

    <div class="field">
      <label>Capital adeudado ($)</label>
      <input type="number" id="capital" placeholder="Ej: 53929">
    </div>

    <div class="field">
      <label>Interés corriente ($)</label>
      <input type="number" id="interesCorrienteValor" placeholder="Ej: 0">
    </div>

    <div class="fila">
      <div class="field">
        <label>Días de mora</label>
        <input type="number" id="diasMora" placeholder="Ej: 72">
      </div>

      <div class="field">
        <label>Tasa de mora mensual (%)</label>
        <input type="number" id="tasaMoraMensual" value="1.5">
      </div>
    </div>

    <div class="field">
      <button class="btn-calcular" onclick="calcular()">Calcular</button>
      <button class="btn-limpiar" onclick="limpiar()">Limpiar</button>
      <button class="btn-pdf" onclick="generarPDF()">Descargar PDF</button>
    </div>

    <h2>Resultados de la liquidación</h2>

    <div class="field">
      <label>Valor de la cuota</label>
      <div class="result" id="valorCuota">$ 0,00</div>
    </div>

    <div class="field">
      <label style="display:none;">Interés corriente (% sobre capital)</label>
      <div class="result" id="interesCorrientePorcentaje" style="display:none;">0,00 %</div>
    </div>

    <div class="field">
      <label>Interés de mora</label>
      <div class="result" id="interesMora">$ 0,00</div>
    </div>

    <div class="field">
      <label>Total a pagar</label>
      <div class="result" id="totalPagar">$ 0,00</div>
    </div>
  </div>

  <!-- Librerías -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <script>
    function formatoMoneda(v) {
      return "$ " + Number(v).toLocaleString("es-CO", {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      });
    }

    function calcular() {
      let capital = parseFloat(document.getElementById("capital").value) || 0;
      let icv = parseFloat(document.getElementById("interesCorrienteValor").value) || 0;
      let dias = parseFloat(document.getElementById("diasMora").value) || 0;
      let tasa = parseFloat(document.getElementById("tasaMoraMensual").value) || 0;

      let cuota = capital + icv;
      let mora = (capital * (tasa / 100) / 30) * dias;
      let total = cuota + mora;

      document.getElementById("valorCuota").textContent = formatoMoneda(cuota);
      document.getElementById("interesMora").textContent = formatoMoneda(mora);
      document.getElementById("totalPagar").textContent = formatoMoneda(total);
    }

    function limpiar() {
      document.querySelectorAll("input").forEach(i => i.value = "");
      document.getElementById("tasaMoraMensual").value = 1.5;

      document.getElementById("valorCuota").textContent = "$ 0,00";
      document.getElementById("interesMora").textContent = "$ 0,00";
      document.getElementById("totalPagar").textContent = "$ 0,00";
    }

    /* --- NUEVA FUNCIÓN PARA PDF PERFECTO --- */
    function generarPDF() {
      const { jsPDF } = window.jspdf;
      const contenido = document.getElementById("contenido");
      const nombre = document.getElementById("nombreDeudor").value || "cliente";
      const archivo = `Liquidacion_mora_${nombre.replace(/\s+/g, "_")}.pdf`;

      const botones = contenido.querySelectorAll("button");
      botones.forEach(b => b.style.display = "none");

      html2canvas(contenido, { scale: 2 }).then(canvas => {
        const imgData = canvas.toDataURL("image/png");

        const pdf = new jsPDF("p", "pt", "a4");
        const pageWidth  = pdf.internal.pageSize.getWidth();
        const margin = 20;

        const imgWidth = pageWidth - margin * 2;
        const imgHeight = canvas.height * imgWidth / canvas.width;

        pdf.addImage(imgData, "PNG", margin, margin, imgWidth, imgHeight);
        pdf.save(archivo);

        botones.forEach(b => b.style.display = "inline-block");
      });
    }
  </script>

</body>
</html>



